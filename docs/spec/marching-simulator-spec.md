# Flight-Level Drill Simulation Logic Framework

## Flight Formation State Machine (Formations & Transitions)

**Formation States:** The simulator models a flight (the basic drill unit) in various formation configurations. A flight consists of *2–4 elements* (files of Airmen). Key formation states include:

- **Line Formation (in Line):** All elements abreast, side by side (e.g. a flight of three elements forms three files side by side, forming multiple ranks). This is the typical stationary formation used for drill, inspections, etc. It can be at **normal interval** (arm’s length spacing between individuals laterally) or **close interval** (4-inch spacing). In line, the flight faces forward as a broad rank. The *guide* (see Guide rules below) is normally at the far right of the front rank (base element).

- **Column Formation (in Column):** A single-file column with one element leading and others following behind (all individuals one behind the other). This is the normal marching formation for any distance. The flight faces and moves forward in the direction of the column. The element leaders and guide march at the front of the column. The guide by default is on the right unless otherwise directed. When halted in column, the flight is “in column” facing the direction of march (essentially a long file). A column formation can also be at normal or close interval between ranks as needed (40 inches distance is standard between ranks; close interval reduces lateral file spacing).

- **Column of Twos/Fours:** Multiple files abreast while marching. Per Air Force drill, the *normal* marching formation can have 2, 3, or 4 elements abreast (depending on the flight size). For example, a “column of twos” is two files marching side by side; a “column of fours” is four files abreast (essentially the whole flight marching in line, used in parades or limited scenarios). In these formations, element leaders of each file are side by side at the front. The guide is typically on the right of the rightmost file (or designated base file).

- **Inverted Line/Column:** A special case where the base element/guide position is reversed (e.g. “guide left” or the flight facing opposite direction). In inverted line, the guide is to the left of the base file instead of the right. In an inverted column (after an about-face of the flight), the guide would be at the rear of the formation until repositioned. The simulator should handle orientation changes (for example, after an about face or counter-march) by tracking the guide/base side.

**Transitions and Commands:** Transitions between these states are effected by specific drill commands:

- **Line ↔ Column (Facing Movements):** When a halted flight in line formation must move out, it is usually faced to march in column. A command like “Right, FACE” (or “Left, FACE”) will pivot the entire flight 90° in place, converting a line formation into a column formation (the right face puts the flight in a column facing what was originally the right). Conversely, a halted column can be faced back into line with a flank-facing command (“Left, FACE” if the flight was in column facing the right, etc.). After facing, the guide and flight commander adjust positions as needed (e.g. when a flight in line faces to the right, the guide performs a *face in marching* to move to the front of what is now the rightmost file). The dress (alignment) is always maintained toward the base element (the flank where the guide is).

- **Forming Up (Fall In):** The command “Fall In” forms the flight in line formation at normal interval. The guide positions on the left of the flight commander (or instructor) and acts as the base; element leaders fall in on the left of the guide and remaining members fill in, automatically dressing right and covering (aligning) 40 inches to the rear. This establishes the initial state. The simulator’s initial state can be a line formation, with all spacing (dress, cover, interval, distance) set: normal interval (~one arm’s length) and standard distance (40 inches) between ranks.

- **Opening/Closing Interval:** At the halt in line, the interval can be adjusted. “At Close Interval, Dress Right, DRESS” compacts the formation laterally to 4-inch intervals. The simulator can treat this as a state change (normal vs close interval spacing) that affects positions for all subsequent movements. While marching in column, interval between files can be adjusted on the move using “Close, MARCH” and “Extend, MARCH”. *Close, MARCH* (given from column at normal interval) causes each element except the base element to pivot and move inwards to obtain close interval while marching. *Extend, MARCH* is the reverse, returning to normal interval. During these moves, the simulator should have each file pivot diagonally and then back, moving a specified number of steps (e.g. first element takes 5 steps between pivots, second 3, etc., as described in the manual). After interval is adjusted, all files half-step until dress, cover, interval, and distance are reestablished, then resume full step on the command “Forward, MARCH”.

- **Column Movements (Turns while marching):** To change direction of march when in column (or in any multi-file column formation), use column movements. Commands: “Column Right (Left), MARCH” (typically followed by a second command “Forward, MARCH” once the turn is completed). On the command, the base element (rightmost element for a column right, or leftmost for column left) pivots 90° and all other elements execute delayed pivots to follow in the new direction. The element leaders execute defined pivot and step counts (for example, in a Column Right, the rightmost element leader pivots 90° immediately, other element leaders pivot 45° and take extra steps before pivoting again so that they stagger into the column). The simulator should implement this by having the base file turn immediately and other files continue forward the required distance before turning, ending up in the same column but oriented 90° from the original direction. During the turn, individuals in each element shorten to half steps after pivoting, allowing other files to catch up and reestablish dress and interval. Once all files are aligned in the new direction, the commander calls “Forward, MARCH” and everyone resumes full 24-inch steps in the new direction. (If executing a *Column Left*, note the base shifts to the left flank: the left element becomes the pivot file and dress is temporarily toward that flank until the turn is complete.)

– **Column Half Right/Left:** A 45° directional change executed similarly to a column movement but with a 45° pivot. Commanded as “Column Half Right (Left), MARCH”. The leading individuals pivot 45° and advance, and others follow on the same pivot point, resulting in a diagonal new direction. All members then resume alignment and full step once abreast. The simulator can treat this as a turn to an intermediate heading. *Incline to the Right (Left)* is an even smaller adjustment: no precise pivot, the guide (or base file) simply drifts slightly to the flank and the rest follow, used for minor course corrections.

- **Flanking Movements:** A flank is an instantaneous 90° turn by the entire formation on the march. The command “Right Flank, MARCH” or “Left Flank, MARCH” causes everyone to pivot 90° in the commanded direction *simultaneously* on the execution command. Each Airman pivots sharply on the ball of the foot (right foot for Right Flank, left foot for Left Flank) and steps off in the new direction with the next foot, without changing relative position in the formation. The effect is that a column formation will become a line formation moving laterally, or a line formation (if one was marching abreast) will become a column moving in the new direction – essentially swapping formation orientation in one move. In Air Force drill, the flight usually **marches in column and uses flanks only for minor repositioning**, since marching long distances in line is not common. The simulator should allow flanks (with perfect pivot execution by all members) and handle the resultant formation change (e.g. after a right flank from column, the flight is now moving as a line formation to the right). The guide remains on the same relative flank as before; during a flank or a “To the Rear” (below), the guide just executes the same pivot and continues – the guide’s position in formation doesn’t change, except if the formation halts and the guide is out of place, in which case the guide moves to align with the front rank.

- **To the Rear (180° turn while marching):** The command “To the Rear, MARCH” causes the entire formation to reverse direction on the march (essentially an about-face while marching). On “MARCH” (given as the right foot hits the ground), each member takes one more step, then pivots 180° to the right on the balls of both feet (upper body remains at attention) and steps off in the opposite direction. They maintain their same positions relative to each other, so a column remains a column (just now facing the opposite way). The guide executes the same movement and continues to lead (now at the front of the reversed column). After completing the pivot, everyone resumes coordinated arm swing and half steps until proper distance/cover is reestablished, then resumes full steps. The simulator should flip the flight’s orientation and heading, handling any phase timing as needed.

- **Counter March:** This is a specialized 180° turnaround for a flight in place when space is constrained (commonly used on a narrow drill pad). Command “Counter, MARCH” (usually called as left foot hits) prompts a series of interwoven pivots: element leaders and files take different numbers of steps and pivot in prescribed patterns to reverse the formation’s direction within its own length. For example, in a four-element flight: the 1st element leader takes 4 steps then pivots right twice around the outside, the 2nd element leader 2 steps then pivots right through the center, 3rd element leader 1 step then pivots left through the center, 4th element leader 3 steps then pivots left around the outside, with each file following its leader’s path. The guide mirrors one of the flank element leaders (typically staying in front of the outermost element). The result is the flight reverses direction, with files swapping order internally. All files go into half step after the pivots and incline as needed to regain close/normal interval and alignment, then the commander commands “Forward, MARCH” once the formation is dressed and covered in the new direction. (This complex maneuver ensures the flight can turn around in place; the simulator can implement a simplified version or directly use the prescribed step counts from the manual for each element leader.)

- **Formation Size Changes (Files and Elements):** The flight can transition between having 1, 2, or 4 files while halted, to navigate in different widths:

- *Column of Files (to Single File):* From a line formation of multiple elements, the command “Column of Files From the Right (Left), Forward, MARCH” is given to form a single file. On the preparatory part (“Column of Files from the Right”), the right-most element leader commands “Forward” while other element leaders command “STAND FAST”. On “MARCH”, the right element steps off as a single file, and each successive element follows in behind as their leader gives “Forward, MARCH” when the last person of the preceding element has passed. The formation thus funnels from many files into one file. In the simulator, this results in one long column: members of the rightmost element go first, followed by the next element, etc., each maintaining 40″ distance behind the last member of the previous element. (If done “From the Left,” the left-most element moves first and others stand fast until it passes. The guide moves to lead the file that moves first, maintaining position at the front.)

- *Multiple Files (Expanding from Single File):* Conversely, from a single file (column) at the halt, the flight can form multiple parallel files. “Column of Twos (or Fours) to the Left/Right, MARCH” will split the column into two (or four) elements abreast. For example, to form a column of *twos* from a single file, on “MARCH” the leader of the original file stands fast, the next half of the column steps out and pivots to form a new file alongside the leader (to the left or right as directed). All members execute the pivots at the same locations, and the new file halts abreast of the original file at normal interval. Essentially, the column is split into two side-by-side columns, roughly half of the personnel in each. (The manual specifies that the “center” of the original column executes a series of half pivots to move abreast of the leader – the simulation can determine the split point: e.g. with an even number of people, the column splits evenly; if odd, one file will have one more person.) Each new element leader halts their file so that they line up evenly with the other file. The end state is two files at normal interval, aligned at the front. This logic extends to forming a column of fours from a single file (splitting into four parallel files, if the flight has 4 elements worth of personnel). That would typically be done by successive splits (file to twos, then twos to fours) or via a single command if starting with exactly four elements. The simulator may implement splitting by successive commands for simplicity.

- *Column of Fours ↦ Column of Twos (Reforming and vice versa):* If a flight is in a column of fours (4 files abreast) and needs to narrow to column of twos (2 files), the command “Column of Twos from a Column of Fours, MARCH” is used (executed from a halt). In such case, the element leaders give supplementary commands: two elements will stand fast (the base two files), while the other two element leaders command “Column Half Left/Right” to move and fall in behind the base files. The moving elements incline in and each halts when abreast of the corresponding base element, creating two files total. The flight is then effectively in column of twos. The reverse (“Column of Fours to the Left/Right, MARCH” from column of twos) has the rear two files come forward and outward to form a wider formation. The simulator can handle these as a coordinated split/merge: in merging, two moving files insert themselves to left and right of the standing files; in forming fours, two files will move out to left and right and forward to form the new leftmost and rightmost files. Timing of halts should be such that all front ranks align. (These are advanced movements; the simulation could simplify by jumping to the end formation once the command is given, or animate the general idea of files fanning out or in.)

**Minor Movements and In-Place Adjustments:** In line formation at the halt, the flight can execute **dressings and counts** without changing state: - *Dress Right, DRESS:* At the halt, this command aligns the formation laterally. On “DRESS”, all Airmen except those on the extreme right of each rank (or as directed “Dress Left” on that flank) lift the left arm horizontally and align themselves to the right, looking along the rank to get in line. At normal interval, each person’s fingertips touch the shoulder of the person to their right. At close interval, left hands are placed on the hip (elbow out ~4 inches from the next person) and alignment is done similarly at close spacing. The flight commander or simulator logic ensures the base (rightmost) individual stands fast and everyone adjusts to line up perfectly side by side. *Ready, FRONT* is given to return to the position of attention, dropping arms simultaneously. “Dress Right, DRESS” does not in itself change the formation state, but it alters individual positions slightly to perfect alignment.

- *Cover:* While not a spoken command in Air Force drill at the flight level (covering is done automatically on dress), *cover* refers to aligning front-to-back (each person looks straight forward and positions themselves directly behind their file leader at 40″ distance). The simulator enforces cover whenever the flight is halted or marching: each member maintains proper distance behind the person in front. If a manual “COVER” command is used (common in some services), it simply makes everyone check their alignment and distance to straighten the column.

- *Open Ranks, MARCH:* This command is used in line formation to space out the ranks for inspection. It only applies when the flight is in line at normal interval. On “MARCH”, the ranks separate: the rearmost rank (4th rank, if present) stands fast; each rank in front of it takes a certain number of paces forward: e.g. in a four-rank flight, the third rank takes 1 pace, second rank 2 paces, and first rank 3 paces forward. This opens about 64 inches between ranks for inspection. All ranks then automatically execute Dress Right, DRESS at the extended distance. (If the flight has only 3 ranks, the last rank stands fast and the others might take 2 and 4 half-steps as needed – the manual gives the specific adjustments to ensure ~64″ spacing.) After inspection, “Close Ranks, MARCH” is given to return the formation to normal distance. On that command, the first rank stands fast, and each rear rank moves up the required number of paces to resume 40″ distance – e.g. second rank takes one pace forward, third rank two, fourth rank three. The simulator should implement open/close ranks by moving ranks forward or back the appropriate number of steps and then re-aligning.

- *Count Off:* In line formation, the command “Count OFF” causes each rank or each file to number themselves. (In typical AF drill, in line formation they count by elements from right; in column formation they count by files to establish numbering.) This doesn’t change formation state but is used for accountability. The simulation may include this as a cosmetic feature where each element leader or each individual calls a number in sequence. For implementation, it’s not crucial to movement logic, so it can be omitted or included as an audio/visual cue (e.g. displaying numbers above heads).

**Summary of State Changes:** In the simulator’s state machine, each *command input* triggers a transition or state change event: - Facing commands at halt rotate the entire formation (affecting orientation and swapping between line/column states). - Marching commands (forward, flanks, columns, etc.) alter the movement direction or formation width, as described, but the simulation should smoothly preserve internal alignment through transitions (using half-steps and pauses where the drill manual specifies). - Formation-change commands (column-of-files, etc.) reconfigure the number of files in the formation. - Interval-change commands adjust spacing parameters without altering the formation’s shape. - The state machine nodes can be defined as: **{formation type, interval, orientation, moving/stationary}** – for example: “Line formation, normal interval, facing north, halted” → (“Right, FACE”) → “Column formation, normal interval, facing east, halted” → (“Forward, MARCH”) → “Column formation, normal interval, facing east, marching”. Each command will have logic to determine the resulting state and animate the intermediate steps.

The structure above ensures that all possible flight-level formations and transitions (excluding higher units like squadrons) are accounted for. The simulator should prevent invalid transitions (for example, “Open Ranks” should only work in a line formation at halt; “Column Right” only while marching in a column formation, etc.) and handle user errors as described below.

## Command Parsing Logic (Preparatory & Execution Commands)

Commands in Air Force drill consist of a **preparatory command** (which indicates what movement or formation change is to be made) and a **command of execution** (which signals when to do it). For example, in “**Forward, MARCH**,” “Forward” is the preparatory command (telling the flight to get ready to move forward) and “MARCH” is the execution command that causes the action. In **spoken input** or text, the simulator should detect this structure and not initiate the movement until the execution word is given.

- **Detection of the Command Parts:** The system will maintain a list of valid commands and their components. The execution command is typically an action word like “MARCH,” “FACE,” “HALT,” “REST,” etc., while the preparatory part can be one or several words specifying the movement (“Forward”, “Left Flank”, “Column Right”, “Open Ranks”, etc.). The parser should identify the last keyword as the command of execution and everything preceding it (within the same input) as the preparatory command. For instance, if the user says “Column right march” or “Column... right... MARCH” with a pause, the system should parse “Column Right” as the preparatory and “MARCH” as execution. The example given – “Forward, hello, left, MARCH” – contains extraneous words; the logic should filter out unrecognized filler (“hello, left”) and latch onto the known pattern “Forward MARCH”. Essentially, it should still find the final “MARCH” and the preceding known direction “Forward” to execute a forward march. Robust parsing will ignore or treat as irrelevant any words between the preparatory phrase and the command of execution that are not part of a valid command phrase.

- **Command Validation:** Once the parts are extracted, the simulator validates the command against known drill commands. If the sequence is not recognized or is incomplete, the simulator can flag an error (e.g. no movement occurs and perhaps an error message or audio “As You Were” is triggered). For example, if a user inputs only “Forward” without “MARCH,” the system knows this is just a preparatory command. In real drill, the commander can give a preparatory command and hold it, but eventually must give a command of execution or cancel with “As You Were.” In the simulation, if the execution command doesn’t follow within a short time or in the same input, the system can either wait or prompt/cancel. The user can explicitly cancel a preparatory command by saying “As You Were,” which in drill terminology revokes the preparatory command before execution. Our logic should handle that by resetting any pending command state.

- **Timing and Execution:** In actual drill, the preparatory and execution commands are given with a cadence – often separated by an interval of one step or so, and called on specific footfalls when marching. The simulator does not require the user to time commands to footfalls, but it should enforce that certain commands are only valid when marching (and potentially even on the correct foot for realism). We assume *perfect execution by flight members*, so the key timing is the user’s input. The system will instantly carry out the movement on the execution command. For added realism, the simulator may internally time the execution to the next animation tick or next footfall of the marching cycle, but this is optional. If voice input is used, the user might speak a continuous phrase (“Flight halt” or “Left face”) – the system can treat a slight pause or the comma in text as the break between parts. The **tone** or **inflection** isn’t available to the parser, but the user is expected to follow the format. Commands like “FALL IN” or “REST” are **combined commands** – they consist of a single phrase with no separate execution word. The parser will recognize those as whole commands that immediately execute (e.g., “Fall In” forms the flight, “REST” puts them at rest).

- **Error Handling (Invalid/Mistimed Commands):** The simulator should allow the user to issue invalid or context-inappropriate commands but respond in a realistic way:

- If a command is given that doesn’t apply in the current situation, the system can ignore it or provide feedback. For example, “Open Ranks, MARCH” given while the flight is marching or in column formation is not valid – the simulator could ignore the input or show a brief indication that nothing happened because the command was out of context. Similarly, “Forward, MARCH” issued when the flight is already marching forward will have no effect (the system may choose to ignore it or acknowledge “Already moving forward”). In real drill, if a commander gave an improper command, troops would attempt to comply in some logical way or stand fast if impossible. In our simulation, since we can’t have the flight guess the intent, we’ll either (a) have them do nothing and possibly output a warning, or (b) if the command was simply redundant (like a second “Forward, MARCH”), simply continue as is.

- If the user gives a *malformed command*, such as “Left, MARCH” (missing the movement – should it be Left Flank or Left Face?), the simulator cannot be sure what to do. It should treat this as an error. We might implement a gentle correction: e.g., no movement occurs and maybe a prompt “Specify LEFT FLANK or LEFT FACE.” The same goes for saying only “MARCH” or an unrecognized phrase.

- If a *supplementary command* (like “Stand Fast” or “Continue to March”) is given by the user – which normally is something subordinate element leaders say, not the commander – the simulator can simply ignore it or treat it as noise unless we explicitly model sub-commanders. In general, the user will act as the flight commander, giving full commands to the flight.

- **Mistimed commands:** Some commands must be given while marching (e.g., flanks, to the rear) and some only while halted (e.g., facing movements, open ranks). If the user attempts a marching movement at halt or vice versa, the simulator should handle it realistically. For instance, “Left Flank, MARCH” while halted – since a flank is a marching move, the flight cannot execute it. We could either ignore it or interpret it as a stationary left face if that seems likely what the user meant. However, that interpretation might confuse things. It’s safer to ignore and perhaps show “Invalid command now.” Likewise, “Left, FACE” while marching is invalid (that would be a flank instead). The system may either ignore it or treat it as an immediate halt + face (though the latter is not a standard combined action). In competitions, an improper command would result in errors – our simulation can just not execute and maybe flash a message.

- **Foot timing realism:** If desired, the simulation can enforce that certain marching commands be called on the correct foot. For example, “Column Right, MARCH” is typically called as the right foot strikes so that execution begins on the next left step. Our AI can note the current step and execute at the next appropriate moment. However, this is a refinement – since perfect execution is assumed, it’s enough to execute immediately and use half-steps where needed to maintain alignment. We won’t require the user to know foot timing; the system internally can align execution on the nearest appropriate foot if implementing footstep synchronization.

- **Flexible Input:** The system may allow some flexibility or shorthand. For instance, the user might just say “Flight, HALT” or even just “Halt” (since the flight is the only unit being commanded). The parser should accept “Halt” as equivalent to “Flight, HALT” (in the manual, “Flight” is the preparatory part that designates the unit, which is only necessary when multiple units are on the field – in our sim the context is one flight). Similarly, “Forward march” or “Forward, march” (with or without comma) should be understood. Case-insensitivity and some tolerance for minor word errors (like “Forwards march”) can make the interface smoother, as long as it’s clear what command was intended.

- **Command Feedback:** Upon recognizing a command, the simulator can provide feedback – for instance, repeating the command or displaying it – then execute. This helps the user know the command was understood. If the command is not understood, the sim can prompt or do nothing (simulating the flight “standing fast” as if no valid command was given).

- **Chaining Commands:** The user should issue one command at a time (preparatory + execution). If the user tries to queue commands (e.g., “Right face then forward march”), the parser likely will only catch the first phrase. It’s recommended to only allow one command execution at a time in the simulation’s state machine. Once a command is executed and the movement is underway or completed, the next command can be given.

- **Mass Commands and Counting:** The manual describes “Mass commands” (where troops themselves call cadence) and counting cadence, but these are training tools. In simulation, we won’t use those as input. Instead, cadence counting or commands like “Detail, HALT” (with everyone saying “HALT” together) could be an optional audio effect. The core parsing will focus on the commander’s commands.

In summary, the command parsing logic splits user input into preparatory and execution parts, validates the command, and triggers the appropriate state transition or movement animation. It will handle extraneous words gracefully, ensure that the movement only occurs on the execution command, and handle incorrect commands by ignoring or providing corrective feedback. This two-step recognition is critical for an AI-based drill instructor: the AI may hear the preparatory command and anticipate the movement, but it must wait for the final command of execution (or a cancellation) before actually changing the simulation state.

## Simulation Rules: Spacing, Alignment, Dress, Cover, and Cadence

The simulation must enforce standard drill spacing and alignment at all times, as well as the timing (cadence) of movements. These rules ensure the virtual flight behaves like a real one, maintaining cohesion and precision.

- **Standard Distances:** The distance from the back of one person to the chest of the person behind (in column) is **40 inches** in Air Force drill. The simulator should initialize and maintain this 40″ distance between ranks (files) when the flight is in column or in line. This means if each person is represented as a point or shape, when standing one behind another, they are spaced 40 inches apart (which roughly corresponds to one pace plus some clearance). Lateral spacing (interval) between individuals side-by-side in line is one arm’s length, approximately **30 inches** for an average adult (the exact distance can vary by person, but we treat it as a constant for simulation). When at *close interval*, that side-by-side spacing is **4 inches** between shoulders (essentially shoulder-to-shoulder). The simulator will use these values to position avatars. For example, in normal interval line formation, each person might be ~30″ apart sidewise (or we can use a fixed value like 36″ for simplicity, but the manual specifies arm’s length). For front-to-back (cover) distance of 40″, we will use exactly 40 in simulation units for uniformity.

- **Dress and Cover (Alignment):** *Dress* refers to side-by-side alignment (all members of a rank align with the base person on the flank), and *Cover* refers to front-back alignment (each person in a file directly behind the one in front). The simulator must enforce these during and after movements:

- When the flight is halted, all members should come to exact positions such that ranks are straight (no one sticks out forward or back) and files are straight (no one off to the side). The guide and element leaders serve as reference points. For example, after a “Halt”, each Airman will automatically adjust to cover (if slightly out of step) by taking up the correct distance behind their file leader. The simulation can snap them into perfect alignment on halt, simulating the minor adjustments real troops make.

- During marching, individuals will maintain dress and cover by adjusting their stride subtly. Since we assume perfect execution, we can simulate this by keeping the formation geometry rigid except when a command intentionally changes it. In reality, alignment is maintained by the members visually dressing to the right or left and holding proper distance by eye. In the simulator, we will treat the formation as a somewhat elastic array: if one person slows or speeds (like during a turn), others follow suit to maintain position. For simplicity, except during those transitional maneuvers, everyone marches in lockstep with exact spacing preserved by design.

- Commands like “Dress Right, DRESS” will explicitly cause a re-alignment: the simulator can animate each Airman except those on the right flank raising an arm and shifting slightly until aligned, then on “Ready, FRONT” arms go down. If not animating individual arm movement, the effect can be instantaneous alignment correction. This command might be used after forming up or after any sloppy movement (though with perfect execution, it’s technically always aligned; but the user might still issue it).

- After any formation transition (columns, flanks, etc.), the simulation should ensure that once the movement is complete, dress and cover are reestablished. For example, after a column movement, as noted, individuals go into half step until intervals and distance are correct. The simulation can simply place them correctly at the end of the maneuver, or simulate the half-step by slowing them until alignment catches up.

- In line formation, *dress* is usually to the right (base element on right) by default. If the guide is on the right, everyone dresses right. If a command “Guide Left” is given, the guide moves to the left flank with the commander, and from that point, the dress would be to the left (the base element switches). The simulator should update which side is “base” for alignment when such guide changes occur. (This could be an internal state flag: guide_position = Left or Right).

- *Cover* is always to the front. The person at the front of a file (element leader) is the position others cover on. If the guide is in front of an element leader (as sometimes happens when marching at an angle or after a face), the guide is effectively the front of a column to cover. The rule of thumb: everyone aligns behind the person directly in front of them in their file.

- If the flight halts in an improper alignment (due to an invalid or premature halt command), the simulation might automatically “dress” them into a proper block. (However, since we assume commands are given correctly for the most part, this may not be needed often. But if a user halts mid-pivot, we could either complete the pivot or freeze them in that odd position; an automatic dress would snap them square which might not be realistic if they halted incorrectly. Possibly better to leave them as-is, illustrating the consequence of a bad halt timing.)

- **Cadence and Step Size:** The flight marches in *quick time* unless otherwise directed. Quick time cadence is **100 to 120 steps per minute** with a standard step length of **24 inches** (heel to heel). The simulator can pick a default (say 112 steps/min) for the visual speed, or even allow the user to adjust within that range. Each step is 24″ forward (except when half-stepping). We will implement movement in terms of these steps: e.g., at 120 steps/min, that’s 2 steps per second. If we use 24 inches as ~0.61 meters, that’s about 1.22 m/s speed (~4.4 km/h). This is the pace the avatars should move at in the canvas. When standing in place, they remain at attention with zero movement (except possible slight head turning if we simulate them looking for alignment on command).

- **Double Time:** If the user commands “Double Time, MARCH,” the flight will step up to **double time**: 180 steps per minute, with a 30-inch step. This is a jog/trot. The simulator should increase speed to 1.5x and possibly change the animation (running with arms at a suitable angle – usually forearms up, as per AF drill, troops raise their arms to waist level, cupped hands, when running). When in double time, note that only limited commands are allowed (no complex movements). Specifically, the manual says the only commands while running are “Incline to the Right/Left,” “Quick Time, MARCH,” and “Flight, HALT”. The simulation should reflect that: if the flight is at double time, the parser should accept only those execution commands (or emergency halt). The user must bring them back to quick time (by “Quick Time, MARCH”) to do other movements. The Quick Time command causes them to slow to normal march with four steps in between (in practice); our sim can just smoothly transition speed down and lower their arms after a second or two to show resumption of normal march.

- **Mark Time & Half Step:** The command “Mark Time, MARCH” causes the flight to march in place. They lift each foot alternately about 4 inches off the ground, keeping time but not moving forward. The cadence remains 100-120 per minute. The simulator should freeze their x,y movement but continue a stepping animation on the spot. Mark time can be started from a halt (they begin marking time in place) or while marching (they transition from moving forward to marching in place – effectively halting forward motion without stopping the stepping). Mark time is used often to wait while still keeping time. When the command “Forward, MARCH” is given while marking time, they resume forward movement with full steps on the next appropriate foot. Our simulation can simply switch their state back to moving and keep cadence continuous. To halt from mark time, the command “Flight, HALT” is given, and they halt just as from normal march (take one more in-place step and stop).

- The command “Half Step, MARCH” tells the flight (while marching) to shorten their steps to 12-inch *half steps*. They still step in cadence, but only half the distance. This is used to let other elements catch up or during certain ceremonial situations. In the simulator, we’d reduce their forward movement per step to half (12″). They maintain arm swing normally. The flight will continue at half step until either commanded to resume full steps (“Forward, MARCH” given while half-stepping) or to halt. We will implement that “Forward, MARCH” while in half step causes them to immediately lengthen to 24″ steps from the next step.

- **Side Step (Right/Left Step):** This is a stationary movement where the flight takes 12-inch steps to the side. The command “Left Step, MARCH” or “Right Step, MARCH” would make each member step laterally in the given direction, 12 inches per step, at a cadence of 100-120 per minute, until “Flight, HALT” is given. This might be used to shift the whole formation left or right a short distance. We can simulate this by moving each avatar laterally in sync. On the halt, if their feet are apart, they’ll bring the trailing foot in to finish at attention. (The manual notes to give the halt as heels come together on a side step.) We will ensure the halt command aligns them back to closed ranks.

- **Change Step:** The command “Change Step, MARCH” is given while marching to have everyone adjust their step timing. In marching, everyone is typically in step (left foot hits ground together). If someone is out of step or as a practice, this command on the left foot causes each person to execute a quick step adjustment: they take one half step with the right foot, then continue with a full step left foot, thereby switching which foot they step off on. In simulation, we don’t really simulate individual footfalls being synchronized (unless we animate legs), but if we do, we could flip the leg cycle for everyone at that moment. From the top-down symbolic view, “Change Step” doesn’t visibly affect formation geometry; it’s an internal timing correction. So it may not need an animation, but we can include it for completeness: if the user issues it, perhaps just assume the flight does it (maybe a subtle pause in movement for a split-second to represent the extra half-step). After that, they continue as before. (This command is mainly relevant if footstep sounds or visuals are in sync – it corrects that sync).

- **Movement Execution and Cadence Synchronization:** All moving maneuvers should be executed at the cadence of quick time (unless in double time). The simulator’s update loop can move each person a certain distance per frame such that in one minute they would cover 120 \* 24″ = 2880″ (240 feet) if at 120 bpm. The relative positions of individuals remain fixed except when a command dictates otherwise. For example, during a Column Right, while element leaders pivot at slightly different times, each person continues to take steps (some might be half steps). We maintain cadence by possibly having those who pivot first go to half step while others are catching up. This can be done by reducing their forward movement in code after their pivot until others complete theirs. We want the entire formation to complete the turn and be back in step together. The manual prescribes that by the time the pivot is done, everyone is half-stepping, then on the command “Forward, MARCH” they all resume full 24″ steps in sync.

- **Turns in place (Facing) vs. marching pivots:** When halted, facing movements (left/right/about face) are executed as sharp pivots with no steps. The simulator can rotate each person in place instantly or over a few frames to simulate a crisp two-count movement (for instance, a Right Face is a 90° pivot on the right heel and left toe in one count, then bring left foot together in second count). These are essentially instantaneous in terms of position (only orientation changes). We enforce that after a face, everyone is still aligned (since they pivoted in place). If any slight shifts occur (guides sometimes have to move when the formation orientation changes – e.g., after a right face from line, the guide steps off to reposition in front of the new front rank), the simulator should handle those as part of the command (for that example, the guide’s movement to the front of the column is automatically executed following the face).

- **Stops and Starts:** On halting, all movement stops together, maintaining alignment. In drill, the halt command is given as either foot strikes the ground; the Airmen take one more full step, then bring the trailing foot alongside the lead foot, coming to attention. Our simulation will implement halts so that if a halt is triggered while marching, every person moves one more step distance (24″ at quick time) from the moment of command, then their velocity goes to zero and they snap to the closest aligned positions (feet together, fully halted). Because perfect execution is assumed, we don’t have stragglers – the entire formation halts in step. If the command “Flight, HALT” is given when the formation is not marching (e.g., already halted or marking time), it is effectively ignored (or we might play a subtle “they are already halted” cue). If given at double time, the troops are trained to take an extra step or two in quick time to slow down before stopping; the sim can simply reduce speed and halt within a step to simulate this.

- **“Route Step” and “At Ease” March:** These commands relax the dress and cadence without changing formation geometry. “Route Step, MARCH” lets the flight march without coordinated arm swing and without staying in step (and they are allowed to make conversation quietly). In simulation, this means we might drop the strict step synchronization and allow a looser look, but since we likely don’t animate each person’s limbs independently, the main effect is that we stop calling cadence and perhaps introduce slight randomness in step timing for each person. They still follow the path and keep interval and distance, but the precision is relaxed: we won’t visually enforce that every left foot hits together (which we aren’t explicitly doing anyway unless we animate it). *No formal drill commands can be given in route step except to incline or resume attention*. The user would have to call them back to attention to execute formal moves. To go back to normal marching from Route Step, the command is “Flight, ATTENTION” given while marching, which tells everyone to resume quick time cadence and dress immediately (this is akin to calling cadence again). We will interpret “Flight, ATTENTION” on the move as equivalent to “Quick Time, MARCH” – everyone resumes coordinated movement and silence except for cadence if given. “At Ease, MARCH” is similar to route step except no talking is allowed; troops continue without cadence, but must remain silent and still keep interval/distance. The simulation difference is negligible (both route step and at ease march appear the same visually – not in step). So we can implement both by turning off cadence synchronization. The only allowed command in these states is “Incline” or to go back to attention (or halt). The simulator should enforce that (e.g., if user tries “Column Right” while at ease march, either ignore or first implicitly make them attention – but better to require the user to call attention or halt first). Typically, one would say “Flight, TENCH-HUT” (attention) or “Quick Time, MARCH” to get them back in step from route step. We can support “Quick Time, MARCH” as a means to return to normal marching if desired.

- **Collision and Spacing Handling:** We assume ideal conditions – the flight has enough space and members keep spacing. The simulation should thus not allow individuals to overlap or bump. For example, during a “Column of Files” or “Column of Twos” movement, the files follow sequentially with 40″ distance; if the user issued a new command too early that would cause collisions, the sim should either delay execution until spacing is satisfied or ignore the new command if it’s truly impossible (but since we assume perfect execution and commands at proper times, this is rarely an issue). Essentially, as long as the user waits for one maneuver to finish before the next, spacing will be fine. If they don’t, the engine should still enforce the geometry (it might result in a slightly non-ideal formation momentarily, but then they’d correct after the next command).

- **Guide and Unit Leader Positions:** The flight commander (who gives commands) usually marches with the flight (in training environments, they might be at the front centered or to the side). The guide, however, *is* a marching member of the formation who sets direction and cadence. The guide’s job is effectively encoded in our simulation rules: the guide is the reference that the rest of the flight unconsciously follows to maintain direction and cadence. In the sim, we treat the whole formation as moving in the commanded direction with the guide at the front-right (by default) acting as the pivot for turns and the one who stays on path during inclines. For instance, in a column movement, the guide (if at the front right) will be in the pivot element and will perform the same pivots as that element leader, then move out front ahead of the formation again, acting as the pace-setter. The simulator should explicitly update the guide’s position: after a turn, ensure the guide ends up on the correct flank of the new direction (for a Column Right, guide stays on the right; for Column Left, if the guide was originally right, the guide position might temporarily switch to the left if not commanded otherwise – however, in AF drill, they often announce “Guide left” before a left turn to move the guide, otherwise the guide remains on original flank). The rule per manual: *the guide stays on the right unless otherwise announced*. During a column left, they note that on the preparatory command “Column left,” dress (and guide) shifts to the left until execution, then reverts to right after the turn. We can simplify: always keep guide on one side (say, the side where the pivot is happening) through a turn. If needed, the user can explicitly command “Guide Left” or “Guide Right” to swap the guide’s side while at halt or marching. The simulation will then have the guide and commander swap positions passing right-shoulder-to-right-shoulder (the guide goes to the left front of the formation). After that, all alignment is to the left. The logic: if guide is on left, base element is leftmost; if guide on right, base is rightmost. The guide sets cadence by default, so we keep speed consistent with the guide’s movement.

- **Perfect Execution Assumption:** Since we assume all Airmen execute commands smartly and simultaneously, we do not model individual lag or errors. Every movement is done with “snap.” For example, on a flank, we will rotate every individual exactly 90° at the same time and continue movement. On dress commands, everyone moves sharply. There is *no straggling*. This simplifies the physics: the formation behaves like a well-oiled machine. Where needed, we will animate slight delays for realism (like the trailing files in a column turn), but those are part of the doctrine, not random error.

- **Cadence Counting and Step Sound:** If implementing audio/step visualization, cadence can be counted or marked. Often, commanders will not count cadence except for training (“HUT, TOOP, THREEP, FOURP...” etc.), but the user could request it. We might include an option to have the system count cadence out loud (especially to help time tricky commands). Also, in *Mass Commands* (for practice, e.g., everyone says the commands together), that’s not needed here. Our focus is on the commander’s voice.

In summary, the simulation enforces the following at all times: **24-inch steps at ~112 steps per minute** (unless half/double time), exact **40-inch front-back distance** and proper **cover**, and alignment (dress) toward the guide. Any deviations caused by maneuvers are corrected by the built-in procedures: half steps, pivots, and alignment commands. The flight will always end up dressed and covered, moving or halted, unless the user intentionally leaves them at route step or an intermediate state.

## Command Definitions and Effects on Flight State

Below is a comprehensive list of supported drill commands and their effect on the flight’s state in the simulator. Each command is identified by its preparatory and execution parts (if applicable), with a description of what the flight does in response:

- **FALL IN:** *Formation command.* This is a combined command (no separate execution word). The flight forms up in line formation at normal interval. In simulation, this spawns/places the flight members in a straight line formation centered on the commander or designated point. The guide positions at the front left (for example) of where the flight should form, and element leaders fall in on the guide, others fill in and automatically dress right and cover. The flight ends at attention, ready for further commands.

- **Dress Right, DRESS / Ready, FRONT:** *Alignment command.* At the halt (in line formation), “Dress Right, DRESS” causes all except the rightmost individuals in each rank to raise left arms and look right to align with the base person. The simulator will straighten each rank laterally. “Ready, FRONT” returns everyone to attention (dropping arms forward and snapping head forward). This command ensures a straight line formation. (If “Dress Left, DRESS” is given instead, it’s analogous but toward the left flank – used if guide/base is on left.)

- **At Close Interval, Dress Right, DRESS:** Similar to above but used when the flight is at close interval. Each person except those on the base flank places left hand on hip (elbow out) and aligns on the base person with only 4″ between shoulders. “Ready, FRONT” then resumes attention. This is typically given immediately after forming at close interval to verify tight spacing. In simulation, it will compress the formation laterally to the close interval spacing.

- **Forward, MARCH:** *Movement command.* This commands the flight to begin marching forward from a halt, or to resume a full 24″ step from a halt/mark-time/half-step. On “MARCH,” every Airman steps off smartly with the left foot, 24-inch step, at the cadence of quick time. The flight’s state changes from “halted” to “marching” (moving). If they were at mark time, they step off forward; if at half step, they lengthen to full step; if at route step or at ease, this command is not used (you’d call “Flight, Attention” to resume cadence instead – see Quick Time below). In the sim, this will start the movement animation and velocity for each member.

- **Flight, HALT:** *Halting command.* This stops the flight from marching. It can be given while moving in any formation or even during mark time. The preparatory command includes the unit (“Flight”) (though the user may omit it for simplicity if only one flight). On “HALT,” each member takes one more step then brings their feet together, halting at attention. The state becomes “halted” and orientation remains whatever it was. If the halt is given when marking time, they take one more mark-time step and stop. If at double time, they take up to two more steps (slowing to quick time) and halt. In simulation, we’ll simply stop them after one step-length distance. The formation remains aligned (due to perfect execution).

- **Right (Left), FACE:** *Facing command.* At the halt, “Right, FACE” pivots the entire flight 90° to the right in place. Each Airman pivots on the appropriate heel/ball of foot, in a two-count movement, ending at attention facing the new direction. “Left, FACE” is similar to the left. This changes the flight’s orientation. Notably, a right face will convert a line formation into a column formation (since what was the front rank becomes the rightmost file) – the flight is now prepared to march in that new direction. The guide will move if necessary to assume the correct position (after a right face from line, the guide performs a face in marching to move to front of the new column). No change in spacing occurs. The simulation will rotate each member and adjust the guide’s position accordingly.

- **About, FACE:** *Facing command.* At the halt, this pivots the flight 180° to the rear. Everyone executes an about-face (to the right, by default) and ends up facing opposite their original direction. This effectively flips the formation orientation (a line facing north becomes a line facing south, etc.). The guide will now be at the opposite flank relative to the original alignment (since the base flank doesn’t automatically swap – e.g., if guide was on right before, after an about face the guide is now at what was the left flank in the new front). In AF drill, an about-face does *not* change the guide side (they specify “inverted line” scenario) until the commander directs it. In practice, after an about face, the formation is an inverted line: guide is now on left, but physically at the rear unless moved. The commander should typically call “Guide Left” *before* an about-face if they want the guide on the proper front side after. The simulator will handle the about-face by rotating all members 180°. If this results in the guide being at the back of the formation, we might automatically move the guide to the front (since usually the flight commander would reposition the guide for movement). The manual says the guide position in inverted line is behind the base file leader until otherwise directed. For simplicity, we may leave the guide where they are and expect a “Guide, POST” type command from the user if needed; however, since the user likely won’t micromanage that, an automatic reposition could be done (or just allow the flight to march “inverted” if they immediately step off to the rear).

- **Right (Left) Flank, MARCH:** *Marching turn (face in marching).* This is given while the flight is marching. On “MARCH,” each member pivots 90° in the direction indicated on their next step and continues marching in the new direction. The entire formation turns as a unit, maintaining relative positions (no wheel or stagger). This will change the formation orientation: a column becomes a line (for the duration of the movement in the new direction). Typically used for quick lateral movements on a parade field. The simulator will rotate the velocity vector of the whole formation 90° and for visual effect might animate the pivot on each avatar. After a flank, because everyone turned together, the formation that was a column is now broadside. The guide’s relative position remains the same in the formation (e.g., if guide was front-right, after a left flank the guide will be at what is now front-left, which might be odd since base side was right – but by doctrine, in a flank the “relative position of the guide does not change within the flight” while moving. They simply execute the movement like everyone else). If the flight halts after a flank without reorienting, the guide may end up not on the front rank; in such a case the guide moves up to the front rank automatically on halt. Our sim can instantly correct the guide to the front rank on halting if needed, to keep things neat.

- **Column Right (Left), MARCH:** *Marching turn (wheeled turn).* This command is given while marching in column (one element or multiple elements in column). The formation will execute a 90° turn with a coordinated wheel movement by elements. The right (or left) flank element is the base that pivots in place; other elements take extra steps to pivot around the same point. The effect: the flight changes direction by 90° while remaining in column formation. In simulator terms, this is a state where the heading changes by 90°, but unlike a flank, not all individuals pivot at the same time/spot – they follow one behind the other. We handle it by animating the first element turning immediately and subsequent elements following their path. The command is often given as “Column Right, MARCH” and once the turn is completed, the commander calls “Forward, MARCH” to resume full steps (during the turn they go to half steps). The simulation will automatically have them half-step during the turn then continue, but the user should issue the Forward, MARCH when everyone has turned to restore full speed (we might also automate this if desired). After the turn, the flight is still in column, just now moving perpendicular to the old direction. (If multiple files like column of twos, a “column right” will still be executed similarly: the base (rightmost) file turns 90°, the other file(s) pivot 45° and 45° to join behind, etc., per the procedure, ending up with the same multi-file formation oriented 90° over. The sim can extend the same logic to multi-file columns.)

- **Column Half Right (Left), MARCH:** *Marching turn.* This is a 45° wheel turn. The formation will turn half as much as a full column movement. The base element pivots 45°; others pivot with required extra steps to maintain dress. This changes the flight heading by 45°. The formation remains intact. Simulation handles it like a smaller version of column turn. Members continue marching (often no Forward, MARCH is needed after a half turn; they will automatically resume full steps once aligned abreast). *Incline* is an even gentler version (few degrees drift), which we can simulate by a gradual heading change.

- **Counter, MARCH:** *Marching reversal.* As described earlier, this reverses the flight’s direction in place using a specific pattern of pivots by each element. In the simulator, when “Counter, MARCH” is given (while marching), we will enact the scripted procedure: essentially, the formation will flip 180° with the order of elements reversed. After completion, the flight will be in inverted column (the last element will now be front, etc.). However, note in the standard procedure, element leaders basically weave so that they come out in the same front-to-back order; *the flight still ends up with the original first element in front*, just facing opposite direction (the files exchange interior positions during the maneuver, but end state is the same order). Actually, to clarify: in AF counter march, the element that was on the left (1st element) ends up still on left in new direction, but what was the rearmost element initially might temporarily be in front during execution. Ultimately, the flight is facing opposite direction, with the guide ending up in front again. The simulation can simply rotate the formation 180° around its center as the outcome, to avoid extremely granular modeling, or animate a general swirl. The safe implementation: gradually shrink their forward speed, pivot in place over a second or two to point opposite, then move out – this approximates the result (though not as precise as the real drill pattern). However, since this is a high-fidelity simulation logic, we could implement according to manual:

  - first file (base file) goes long way around, last file goes short way around, etc. We likely won’t simulate each pivot exactly but ensure no collisions. The end result is orientation reversed.
  - After a counter march, all members will likely be out of alignment slightly, so as per manual they go into half step and adjust dress/cover, then are given Forward, MARCH to resume. The simulation should enforce that alignment is regained before proceeding (e.g., maybe a slight pause or automatic half-step for a moment).

- **Close, MARCH / Extend, MARCH:** *Interval adjustment.* These can be given at halt or while marching in column formation. “Close, MARCH” (from normal interval) will compress the lateral space between files to close interval. At the halt, the command makes each element (except the base element) take a number of side steps to the right to achieve 4″ interval: e.g., if four elements, 1st element moves 6 steps right, 2nd 4 steps, 3rd 2 steps, 4th stands fast. While marching, it’s done by diagonal pivots: trailing elements pivot 45° inward, take a few steps, pivot back 45°, ending up closer together. The manual’s specifics (first element takes 5 between pivots, second 3, third 1, etc.) will be encoded. The result is the flight goes from wide spacing to tight spacing laterally. The simulation will reposition files closer and likely slow to half step during the maneuver, then command Forward, MARCH (or automatically resume) such that they return to full steps at close interval. “Extend, MARCH” is the opposite: from close to normal, either at halt (side steps left by each element except base) or on the move (45° outward pivots and steps). We will implement these precisely so that intervals become standard or close as commanded.

- **Route Step, MARCH:** *Marching posture command.* As described, this allows the flight to march without a strict cadence or formal attention. In sim, we toggle a “route step” mode: individuals might have slight random variations in step timing, and we stop playing cadence. They can appear more relaxed. Importantly, the flight *does not* have to stay in step or silent. The formation geometry remains (spacing is usually still kept, dress is more relaxed but they generally stay in position). The only command allowed thereafter is “Incline” or to go back to quick time. The user must either halt or call them to attention (Quick Time) to exit route step. So route step mode is a state (marching_at_ease = true). No other movement command (flanks, columns) should be given in that state (the sim can ignore them or require attention first). To simulate regaining attention: the user issues “Flight, ATTENTION” while marching (or “Quick Time, MARCH”), which we interpret as resuming normal march. All individuals immediately get back in step and assume the position of attention (no head turning, arms swing coordinated, silence). We then treat it as normal quick time marching again.

- **At Ease, MARCH:** Similar to route step, except the troops must remain silent (no talking). Visually the same as route step in our simulation (since we’re not simulating conversation), so it will be treated the same internally: march without cadence, out of step allowed. Also only incline or halt allowed until attention resumed.

- **Incline to the Right/Left:** *Minor direction change.* This command (which has no execution word, it’s a one-part command given while marching) causes the guide (and flight) to drift gradually to a new direction. There’s no precise angle or pivot – it’s a slight turn (perhaps up to 30° or so). In the simulator, we can interpret it as “adjust heading a bit to the right/left.” We might implement it by rotating the formation’s direction a few degrees over a span of several steps. The formation remains intact and this is typically used at route step or any time a slight correction is needed. After inclining, the flight continues on the new heading. If a user wants to fine-tune direction (like guide around an obstacle), multiple incline commands or manual steering could be used.

- **Double Time, MARCH:** *Tempo command.* Puts the flight into a jog (double time). On “MARCH,” all members raise forearms (bent at elbows) to about chest level and begin an easy run at 180 steps/min with 30-inch strides. The simulator will increase movement speed (approx 2x faster than quick time) and can change the animation to a run. Only “Incline,” “Quick Time, MARCH,” or “HALT” can follow in this mode. The flight will not execute flanks or columns at double time (the sim should block those commands unless the user first comes to quick time). This state persists until a “Quick Time, MARCH” is given (or halt).

- **Quick Time, MARCH:** *Tempo command.* If the flight is in double time (running) or route step, this command brings them back to standard march. In double time, the manual says give it with four steps warning; upon “MARCH,” everyone resumes quick time: they slow down to 24″ steps, drop arms to their sides, and coordinate step. In simulation, we’ll smoothly decelerate to normal speed over a second or two and switch animation to marching. If they were at route step or at ease, “Quick Time, MARCH” (or “Flight, ATTENTION” which has similar effect) will cause them to get back in step and resume disciplined marching (cadence and alignment). We will treat “Flight, Attention” given during marching as equivalent to Quick Time for our purposes: it means resume marching at attention (since technically “Flight, ATTENTION” is a halt command when stationary, but when moving it’s used to regain order).

- **MARK TIME, MARCH:** Starts marching in place. If halted, everyone begins to lift knees and feet alternately, raising feet about 4 inches, at quick time cadence. If moving and this command is given, they will transition to mark time: effectively halting forward movement but continuing to step. The simulator will zero out forward velocity but keep the step cycle going (if visualized). This is used to hold the flight temporarily while keeping time (for example, if the commander needs to wait a moment before halting or if dressing in place). To get out of mark time, the user can give “Forward, MARCH” to resume moving, or “Flight, HALT” to stop completely. Halting from mark time is executed just like from quick time (one more step and stop).

- **Half Step, MARCH:** While marching, this command shortens the step to 12 inches. On “MARCH,” each Airman immediately adjusts the stride length to half, though cadence remains the same. In sim, we reduce forward speed by half. They continue at this reduced pace until another command. Usually, “Forward, MARCH” is given subsequently to return to full step, or a halt might be given. (Half step is often used when the flight is approaching a point where it might need to halt soon or to restore alignment.) We will allow “Forward, MARCH” to cancel half-step and go back to full stride.

- **Change Step, MARCH:** While marching, this causes each individual to execute the change-step maneuver to get on the correct foot. On “MARCH,” each Airman takes one more 24″ step with the left foot, then a 12″ half step with the right foot, then steps off again with a full 24″ left foot step. This results in switching the order of feet so that, for example, if a person was out of step, they will now be in step. In formation, if everyone executes it together, technically they all stay in step with each other (it’s more used when someone is off, or in a situation like band). In our simulation, since we presume they were in step, this command doesn’t visually change much. We may implement it by a slight pause (the half step) in the animation cycle, but overall the formation continues moving at the same speed (because they all did it simultaneously, no net effect on distances). We include it for completeness, and it would not typically be used unless for demonstration.

- **Open Ranks, MARCH:** As described in the formation section, this expands the distance between ranks for inspection. On “MARCH,” the rear rank stands fast, each rank ahead takes 1, 2, or 3 paces forward (depending on how many ranks). The simulator will move the front rank forward ~3 steps (covering ~72 inches), second rank ~2 steps (48″), third rank ~1 step (24″), leaving ~64″ between ranks. They all then automatically execute a Dress Right. The flight commander (user) would then likely move through the ranks for inspection, but that is beyond pure marching mechanics (could be a separate mode). After that, the user will give **Close Ranks, MARCH**: on which the front rank stands fast and each other rank moves up appropriate steps (essentially the reverse: second rank 1 step up, third rank 2, fourth rank 3), re-establishing 40″ distance. The sim will then have everyone back in their original positions.

- **Parade REST / AT EASE / REST (halted only):** These are stationary rest positions. “Parade, REST” causes everyone to move left foot out ~12 inches and clasp hands behind back, eyes straight ahead. “At Ease” is similar but members can relax and move arms slightly (but right foot stays in place). “Rest” allows even more relaxation and quiet talking. These commands do not move the formation, just individual postures. The simulation might not detail posture changes (unless avatars have states). We can at least acknowledge the command to indicate the flight is at rest (and thus must be called to Attention before they can move again). Before any marching or facing commands, the flight must be at attention. So the user should call “Flight, ATTENTION” to bring them up. The sim will enforce that (e.g., ignore a “Forward, MARCH” if they are at ease). We might provide a UI indicator (like their status is ‘At Ease’). For logic, it’s straightforward: at ease state = true prevents movement commands until attention given.

- **Dismissed:** Finally, though not part of marching maneuvers, often “DISMISSED” or “Dismiss the flight” would break the formation. If the user issues “DISMISSED,” we can have all avatars disperse (the sim might just end the scenario). But in formal drill, typically the command is “Flight, HALT” then “DISMISSED” (or “DISPERSE” in some manuals). For completeness, we can handle “Dismissed” as a command that causes everyone to salute (if an officer present) and fall out. It ends the simulation scenario logically.

Each of these commands will be implemented as functions or methods altering the state machine of the flight. For example, a `commandForwardMarch()` function will check that the flight is halted (or marking time/half step), then set state to marching forward and update velocities; a `commandColumnRight()` function will only execute if state is “marching” and formation is columnar, and will schedule the pivots for each element, etc. By structuring it this way, we ensure invalid commands are caught (the function can return or throw an error if context isn’t correct).

We will also include **supplementary element commands** implicitly in certain maneuvers: e.g., during “Column of Files” or “Column of Twos” formation changes, the element leaders giving “Forward” or “Stand Fast” are simulated by the logic. The user does not separately command those – the AI logic does it automatically per the maneuver. The manual notes these supplementary commands (like element leader of right element says “Forward” while others say “Stand Fast”). In simulation, we can simply implement the effect (only one element moves immediately, others wait).

## Facing, Halting, and Guide Movement Guidelines

Finally, we detail special considerations for facing movements, how halts are handled, and the role of the guide in movements, to ensure clarity and precision in the simulation:

### Facing Movements (Stationary Turns and Pivots in Marching)

- **Stationary Facings:** When the flight is halted and at attention, facing commands (Left, Right, About face) are executed in unison. The simulator should perform these as instantaneous orientation changes for all individuals (or animated over a very short duration). *Right Face:* Everyone pivots 90° to the right, standing on the right heel and left toe, then brings their left foot smartly alongside right to complete the turn at attention. *Left Face:* Similar, pivot on left heel, right toe, then feet together. *About Face:* Everyone pivots 180° to the right (on right heel and left toe) to face backward. Since all face at once, the formation’s shape doesn’t change, only its orientation. The key guideline: individuals do not drift from their spot – the point of pivot is their position’s center. Thus, after facing, the dress and cover should remain as it was (assuming perfect pivot). In practice, some minor alignment might be needed if people were off, but we assume perfect.

- **Face in Marching (Flanks):** The term “face in marching” refers to pivoting while marching (essentially the flank movement). We have covered flanks above. The guideline for simulation: ensure that at the moment of execution, each person pivots sharply 90° and that their next step is in the new direction with the correct foot (the command timing ideally ensures they pivot on the correct foot – but we will approximate it). Everyone should pivot at the same point in time. This could cause a slight visual “stagger” if some were slightly ahead, but we assume they all execute at once. If the formation was in column, after the flank, they line up abreast. If they were in line and flanked, they line up in column. The sim should automatically maintain interval after the flank (since they all pivoted simultaneously, the spacing remains the same, just reoriented).

- **Combined Facing & Marching:** Some commands involve a facing as part of a marching movement. For instance, during column movements from a halt, element leaders might do a face in marching to initiate movement. The simulator should handle these as part of the movement logic (we did above: for a Column Left from halt, the element leaders execute an immediate left face and step off, rather than taking a forward step). A guideline is that any time a movement says “face in marching,” we implement a pivot-in-place with a step. Another example: *Incline* commands are more gentle – no formal face, just drifting, which we treat differently.

- **Precision and Snap:** In a real evaluation, judges watch the crispness of facings. Our simulation, to reflect that, should ideally not have any “slope” or misalignment after a face. We should snap everyone exactly 90° or 180°. If using sprites or top-down markers, they should rotate accordingly. No individual should overshoot or undershoot – we enforce perfect 90° angles. This emphasizes the logic: orientation of flight changes in discrete known increments (except incline).

### Halting and Step Timing

- **Halting:** The halt procedure is important to get right. The command is given as either foot strikes ground (so there’s some flexibility). Once “HALT” is spoken, each person knows they must take one more step and then stop with feet together. The simulator will implement this by completing the current step cycle plus one, then stopping movement. This ensures uniform stopping. If the user gave halt a bit off-time (since we aren’t tracking footfalls explicitly in input), we can assume it was on a foot and just do one more step. Everyone should finish with heels together, on line. If for some reason the formation was not perfectly aligned at the moment of halt (maybe after route step), they might not halt in perfect ranks. However, typically, halt is given when they are *at attention* (in step). If they were route stepping and got a halt, they’d just stop where they are. In our sim, we normally wouldn’t halt from route step without first calling them to attention, but if it happens, we can still snap them into alignment (because real flights would do a “pick up, cover, dress” after halting from route step). We might auto-correct minor positioning on halt for neatness.

- **Halting from Different States:**

- From quick time: as above.

- From mark time: one more knee lift and down, then freeze.

- From half step: one more half step, bring feet together.

- From double time: they may automatically drop to quick time for two steps then halt. We can simulate that by taking perhaps 2 smaller steps after halt command to slow down, or just a direct stop with maybe a tiny overshoot that we correct (but given perfect execution, they’d manage it).

- From route step/at ease: they halt as they are, likely not all in perfect step. But since we assume some uniformity still, we’ll just stop them. If some are half-step ahead, that’s detail we might ignore, or we could allow a tiny variance in stop timing to reflect no cadence – but that conflicts with our perfect assumption. Probably easier to have them all stop together anyway.

- **Post-halt Alignment:** In a real scenario, after a halt from route step or any relaxed state, the commander might need to dress the flight because individuals could be staggered. The simulator could automatically perform a dress alignment on halt if coming from route step to make them look orderly. Or it can leave them and expect user to issue “Dress Right, DRESS.” Since we want to emphasize correct procedures, we might leave slight disorder if halted from a non-attention state to cue the user to align. However, given that might confuse some, an automatic alignment might be kinder. This is a design choice.

- **Resume Marching:** Getting back from halt to march (Forward, MARCH) was described: step off on left foot, all together. If the flight was at ease or parade rest, the user must call them to attention first (“Flight, ATTENTION”), which returns them to the position of attention (no movement) – then “Forward, MARCH.” We should enforce that you cannot go straight from rest to marching without an attention; if the user tries “Forward, MARCH” while at ease, either ignore or implicitly bring them to attention and step off (the latter is not standard, so better to require attention explicitly).

- **Step Synchronization:** The sim doesn’t visually show left/right foot unless we animate it, but conceptually, all troops step with the same foot at the same time when at attention (usually left foot on the first beat of a march). We should maintain an internal phase or at least ensure that any time they go from halt to march, they effectively start in sync. If an individual was out of sync (e.g., due to route step), “Flight, ATTENTION” while moving will force them back in sync (in real life, they’d shuffle to catch the beat). We can just instantly sync them.

- **Guide and Commanders during Halt:** Typically, when halting while marching in column, if the guide was not already on the front rank (e.g., guide was on an inner rank due to weird prior moves), the guide moves up to align with front rank automatically. Our logic: after a halt, ensure the guide’s position is at the front of the flight (same line as element leaders). If not, move them up. (This is a corner case, mostly if an inverted situation happened or if they halted mid-turn). We want the guide at front to set base for next moves. We also ensure the commander (if visualized) moves to wherever needed (the commander often posts 3 paces in front of flight centered after halting, but that’s more in ceremonies – could be ignored for our context).

### Guide Movement and Role

The *guide* is crucial in drill as the reference point for direction and alignment. In our simulation framework:

- **Guide Position:** By default, the guide is on the right of the formation (rightmost person in the front rank or front file). This means:

- In line formation (flight facing forward), the rightmost front person is the guide (the base for dressing).

- In column formation (flight facing to the right, single file), the guide is also at the front (since the rightmost in front rank is basically the one at the head of the column).

- During marching, unless told otherwise, guide stays on right. If the flight is moving in a direction such that the guide is physically not on the external flank, a command “Guide Left/Right” should be used to reposition.

- The manual states: *“Unless otherwise announced, the guide in line or column, marching or halted, is to the right. In inverted line, guide is left.”* So we’ll adopt that.

- **Guide Left / Guide Right commands:** These are explicit commands to change which flank the guide is on. If the user says “Guide Left,” the current guide (say at right) and the person on the opposite flank (often the flight commander or an element leader on left) will swap positions by moving around behind the formation to exchange places. In our sim, because we are focusing on flight members and not the commander, we can simplify: “Guide Left” means the guide falls out and moves swiftly to the front-left position of the flight. In practice, the flight commander (if leading from front) would swap with guide, but if we don’t show the commander, we just show the guide shifting flanks (or we can assume flight commander exists separately). Either way, effect: guide is now the leftmost front person, and alignment/dress will be to the left. Everyone will dress to the left automatically after this change (the command effectively announces new base). The manual says you can do this while marching or at halt; they pass right-shoulder to right-shoulder, meaning the guide goes behind the leader. For simulation, we might just teleport or quickly move the guide avatar from one end to the other for simplicity. After that, we set a flag that guide_position = left. If “Guide Right” is given, we swap back.

- **Guide in Marching:** The guide sets the direction and cadence. In practical terms, this means:

- The path the guide takes is the path the flight will follow. In simulation, we can conceptualize the guide as the “steering” point. For example, when executing a column movement, the guide (if at the front right in a Column Right scenario) will perform the pivots exactly as the base element leader and then continue, eventually moving slightly ahead to resume position. We should ensure the guide stays at the front of the formation’s movement.

- If the flight is marching and needs to make slight adjustments (inclines), the guide will be the one actually doing it, and everyone else follows. The simulator can implement inclines by gently turning the guide and subsequently the formation.

- If the flight is in line formation marching (rarely), and they execute a movement like a turn, often the guide needs to move to the new leading position. The manual explicitly covers: when a flight in line is commanded to face/march to the right, the guide does a “face in marching” to get to the front of what will be the new formation. So our rule: any time the flight’s orientation changes such that the guide is not at the front of the direction of march, we reposition the guide to the front. This covers facing movements and some formation changes. We already noted: after a right face from line, guide goes to front of now-column. After an about face, guide (if remained right) is now at the *rear* of the new direction – not acceptable if we step off that way, so presumably the commander would move the guide or call guide left. We either auto move the guide to front-left (making them guide left in new front) or expect a Guide Left command. Perhaps easiest: if about face is immediately followed by forward march, we’ll treat it as if they are now marching inverted (guide at rear) which doesn’t make sense; better to auto-swap guide to left front in that case. But to stick to authenticity, maybe require the user to do “Guide Left” beforehand to avoid that scenario. In an eval, they would know to do that.

- The guide also maintains cadence. We simulate cadence uniformly, so effectively the guide’s step timing is the master clock for everyone. If we were to simulate, say, a slight variance at route step, that’s because guide stops controlling cadence, but normally, everyone is stepping to guide’s pace. If the user tries to speed up or slow down the marching speed outside of standard, that’s not a typical command (except calling Mark Time or Half Step or breaking into double time). We might allow incremental speed changes via UI but those wouldn’t be official commands; if we do, perhaps we treat the guide as doing it and everyone follows.

- **During Turns and Maneuvers:**

- In a Column Right (guide on right), the guide is in the pivot element (front right person). The manual says the guide pivots same as fourth element leader (assuming 4th element is on right) and after pivoting, continues until ahead of that element, then pivots 45° to position in front of them and half steps. This is a detail ensuring the guide ends up slightly ahead to lead. Our sim can implement that literally (guide takes an extra step out to get in front). In simpler terms, after the turn, ensure guide is at the front of the formation by a fraction of a step so we can consider them leading.

- In a Column Left (guide was on right, presumably), now the base element is leftmost. The manual instructs that on “Column Left” prep, the dress shifts to left (meaning effectively treat guide as left for the turn), then after executing, guide reverts to right flank being base again. This is a bit complex: basically, they don’t physically swap guide mid-march; rather the responsibility for alignment temporarily shifts. For simulation, we can cheat: we can either temporarily designate the left front person as a pivot and still keep the actual guide where he is but just have him follow, or we could actually move the guide across during the turn (which they don’t do in real life, they just say “guide left” beforehand if needed). Realistically, if an evaluator wanted to do column left with guide still on right, they’d call “Guide Left” just before it to have the guide swap sides. So to keep it consistent: if user will do column left, they should do guide left first. If they don’t, perhaps we automatically do it at execution: on “Column Left, MARCH” if guide is right, we might treat the leftmost element leader as acting guide for that move.

- For simplicity, we can instruct in documentation (or enforce logically) that before doing a column to the side opposite the guide, the user should issue a “Guide X” command. But our job is to simulate consequences if they don’t too (maybe alignment will be weird).

- **Guide’s Importance in Alignment:** The dress is always towards the base (guide) side. That means:

- When halted in line, everyone aligns to guide’s side.

- When marching in column, everyone covers straight behind guide (guide is front of base file).

- If guide switches side, the base changes and the flight must realign to that side. In our simulation, after a “Guide Left” or “Guide Right,” we should automatically trigger a Dress command to the new side (or assume they do it). The manual suggests that after guide swaps, the formation should be dressed to the new base. Possibly we simulate that by an immediate slight shift of files to align with the new base file leader. We might simply maintain internal consistency that positions are measured from base file outward. So if base changes, positions might mirror.

- **Guide and Element Leader leaving formation:** Not directly asked, but sometimes drill commands like “Guide, POST” or calling element leaders out exist (like *Individuals to Leave Ranks* command allows someone to step out). The question scope doesn’t require that level of detail (except maybe for inspection, which is a ceremony detail we can skip aside from open ranks). So we won’t simulate individuals leaving formation except the guide moving as part of guide commands.

- **Guide in Diagrams:** The simulation may visually mark the guide (maybe a different color or an icon) so the user knows who it is. Because in some cases (like after an about face, or after some complex moves) the user might need to track if guide side changed. We could automatically manage it mostly, but it’s good for a user to know.

In essence, the guide’s movement guidelines for the sim are: - Keep the guide at the front of the moving direction of the flight whenever possible. - If the flight’s movement direction changes and the guide ends up not on the leading flank, either move the guide or expect a guide change command. - The guide’s presence is implicitly factored into how we align everyone (dress to guide side, etc.). Our algorithms for dressing or interval should always use the guide’s file as reference (for cover/distance) and guide’s rank for dress.

By following the above logic framework, the simulator will comprehensively cover flight-level drill movements as per DAFPAM 34-1203. We have defined the state machine of formations (line, column, columns of multiple files, intervals) and how commands transition between them, parsing of commands in preparatory/execution format with robust error handling, the rules of maintaining spacing, alignment (dress/cover) and cadence, detailed descriptions of each command’s effect on the flight’s state, and guidelines for facing movements, halting procedures, and guide behavior. All these are implemented in accordance with Air Force drill standards (2022), ensuring that a 2D top-down simulator will emulate an accurate and evaluative representation of an Air Force flight drill.

**Sources:** The logic above is derived from *Department of the Air Force Pamphlet 34-1203 (Drill and Ceremonies)*, which provides the authoritative guidance on these movements, as well as standard drill conventions. The simulator implementer can refer to the cited sections for verification of specific movement details and ensure the code reflects those procedures precisely.
